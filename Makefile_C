PROJECT_NAME = libkusnik

CC        = g++
AR        = ar -cqs
RANLIB    = ranlib

FLAGS     = $(CFLAGS) $(OPTFLAGS)
CFLAGS    = -Wall -pedantic -ansi -fopenmp -fPIC
OPTFLAGS  = -O2 

LIBS      = -lm -lpng -liqa 

SRC_DIR   = src
OBJ_DIR   = objects
BIN_DIR   = bin
MAIN_DIR  = main
LIB_DIR   = lib
INC_DIR   = include

SRC_FILES = $(wildcard $(SRC_DIR)/*.cpp)
OBJ_FILES = $(addprefix $(OBJ_DIR)/, $(notdir $(SRC_FILES:.cpp=.o)))
MAIN_FILES = $(wildcard $(MAIN_DIR)/*.cpp)
MAIN_OBJ_FILES = $(addprefix $(OBJ_DIR)/, $(notdir $(MAIN_FILES:.cpp=.o)))
BIN_FILES = $(addprefix $(BIN_DIR)/, $(notdir $(MAIN_FILES:.cpp=)))

INSTALL_DIR_LIB    = /usr/local/lib
INSTALL_DIR_HEADER = /usr/local/include

#--------------------------------------------------------------------------------------
default: $(OBJ_FILES)

#--------------------------------------------------------------------------------------
$(OBJ_DIR)/%.o: $(MAIN_DIR)/%.cpp $(OBJ_FILES) 
	@echo "Compiling [$(notdir $<)]"
	@$(CC) -c $< $(FLAGS) $(LIB_PATHS) -I$(INC_DIR) -o $@
	@echo "Linking objects to exec file [$(BIN_DIR)/$*]"
	@$(CC) -o $(BIN_DIR)/$* $(OBJ_FILES) $@ $(FLAGS) $(LIBS) $(LIB_PATHS) -I$(INC_DIR)

#--------------------------------------------------------------------------------------
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	@echo "Compiling [$(notdir $<)]"
	@$(CC) -c $< $(FLAGS) $(LIB_PATHS) -I$(INC_DIR) -o $@ 

#--------------------------------------------------------------------------------------
main: $(MAIN_OBJ_FILES)
	@mkdir -p $(LIB_DIR)
	@mkdir -p $(BIN_DIR)

#--------------------------------------------------------------------------------------
lib: $(OBJ_FILES)
	@echo "Creating static library $(OBJ_DIR)/$(PROJECT_NAME).a" 
	@$(AR) $(LIB_DIR)/$(PROJECT_NAME).a $(OBJ_FILES);
	@echo "Creating dynamic library $(LIB_DIR)/$(PROJECT_NAME).so"
	@$(CC) -o $(LIB_DIR)/$(PROJECT_NAME).so  -shared  $(OBJ_FILES)

#--------------------------------------------------------------------------------------
install: lib 
	@echo "Creating Directories"
	@mkdir -p $(INSTALL_DIR_LIB)/
	@mkdir -p $(INSTALL_DIR_HEADER)/
	@echo "Copying files"
	@cp $(INC_DIR)/*.h $(INSTALL_DIR_HEADER)/
	@cp $(LIB_DIR)/$(PROJECT_NAME).a $(INSTALL_DIR_LIB)/
	@echo "Done."

#--------------------------------------------------------------------------------------
clean:
	@echo "Cleaning up..."
	@rm -f $(OBJ_DIR)/*.o
	@rm -f $(BIN_DIR)/main_*
	@rm -f $(BIN_DIR)/out_*
	@rm -f $(LIB_DIR)/*
	@rm -f core
	@echo "Done."

#--------------------------------------------------------------------------------------
uninstall: clean
	@echo "Uninstalling..."
	@rm -f $(INSTALL_DIR_LIB)/$(PROJECT_NAME).a
	@rm -f $(INSTALL_DIR_HEADER)/arbitraryUtil.h
	@rm -f $(INSTALL_DIR_HEADER)/image.h
	@rm -f $(INSTALL_DIR_HEADER)/jconfig.h
	@rm -f $(INSTALL_DIR_HEADER)/jdct.h
	@rm -f $(INSTALL_DIR_HEADER)/jdhuff.h
	@rm -f $(INSTALL_DIR_HEADER)/jerror.h
	@rm -f $(INSTALL_DIR_HEADER)/jinclude.h
	@rm -f $(INSTALL_DIR_HEADER)/jmemsys.h
	@rm -f $(INSTALL_DIR_HEADER)/jmorecfg.h
	@rm -f $(INSTALL_DIR_HEADER)/jpegint.h
	@rm -f $(INSTALL_DIR_HEADER)/jpeglib.h
	@rm -f $(INSTALL_DIR_HEADER)/jversion.h
	@rm -f $(INSTALL_DIR_HEADER)/libmorpho.h
	@rm -f $(INSTALL_DIR_HEADER)/qsort.h
	
	@echo "Done."
